<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="mctoolsr : Microbial community analysis tools in R">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>mctoolsr</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/leffj/mctoolsr">View on GitHub</a>

          <h1 id="project_title">mctoolsr</h1>
          <h2 id="project_tagline">Microbial community analysis tools in R</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/leffj/mctoolsr/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/leffj/mctoolsr/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="getting-started-with-mctoolsr" class="anchor" href="#getting-started-with-mctoolsr" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting Started with mctoolsr</h1>

<p>Jonathan W. Leff<br>
2016-06-14  </p>

<p><strong>mctoolsr</strong> (prononounced M-C-tools-R) is an <strong>R</strong> package developed to facilitate microbial community analyses. The current functions are meant to handle an input taxa (OTU) table in either biom or tab-delimited format and help streamline common (and more specialized) downstream analyses. It is under active development, so please submit bug reports and feature requests as indicated below.</p>

<p>This document serves as a brief introduction to using <strong>mctoolsr</strong>. This document will go through getting the package working and a few examples using the most popular functions.</p>

<p><strong>See here for a list of current functions</strong>: <a href="https://github.com/leffj/mctoolsr/blob/master/function_list.md">https://github.com/leffj/mctoolsr/blob/master/function_list.md</a></p>

<h3>
<a id="other-tutorials" class="anchor" href="#other-tutorials" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Other tutorials</h3>

<ul>
<li><a href="https://github.com/leffj/mctoolsr/blob/master/tutorials/modifying_plots.md">Modifying plot appearance</a></li>
</ul>

<h3>
<a id="getting-and-using-mctoolsr" class="anchor" href="#getting-and-using-mctoolsr" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting and using <strong>mctoolsr</strong>
</h3>

<p><strong>mctoolsr</strong> is available on Github at: <a href="https://github.com/leffj/mctoolsr">https://github.com/leffj/mctoolsr</a></p>

<p>To install:</p>

<div class="highlight highlight-source-r"><pre>install.packages(<span class="pl-s"><span class="pl-pds">"</span>devtools<span class="pl-pds">"</span></span>)
<span class="pl-e">devtools</span><span class="pl-k">::</span>install_github(<span class="pl-s"><span class="pl-pds">"</span>leffj/mctoolsr<span class="pl-pds">"</span></span>)</pre></div>

<p>To use in a script, load and attach the package using:</p>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">mctoolsr</span>)</pre></div>

<h3>
<a id="updating-mctoolsr" class="anchor" href="#updating-mctoolsr" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Updating <strong>mctoolsr</strong>
</h3>

<p><strong>mctoolsr</strong> is under active devlopment. Update regularly to use the latest features and for bug fixes. You will have to load and attach as above after updating.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-e">devtools</span><span class="pl-k">::</span>install_github(<span class="pl-s"><span class="pl-pds">"</span>leffj/mctoolsr<span class="pl-pds">"</span></span>)</pre></div>

<h3>
<a id="to-report-bugs-or-request-features-go-to" class="anchor" href="#to-report-bugs-or-request-features-go-to" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>To report bugs or request features, go to:</h3>

<p><a href="https://github.com/leffj/mctoolsr/issues">https://github.com/leffj/mctoolsr/issues</a></p>

<h3>
<a id="citing" class="anchor" href="#citing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Citing</h3>

<p>The package is in initial development, so for now, please simply cite the Github URL: <code>https://github.com/leffj/mctoolsr/</code></p>

<h3>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Examples</h3>

<p>Note that the following examples use an example dataset taken from a study examining the bacterial communities associated with fruits and vegetables (<a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0059310">Leff et al. 2013</a>). You can find this dataset in the mctoolsr/examples directory.    </p>

<h4>
<a id="loading-taxa-tables-and-metadata" class="anchor" href="#loading-taxa-tables-and-metadata" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Loading taxa tables and metadata</h4>

<p>You can load a taxa (i.e. OTU) table in biom format using the following approach. Note that you don't need to use <code>system.file()</code> when using your own filepaths -- just use the filepath directly. This function just helps your system find the example files.</p>

<p>One of the nice things about loading your data this way is that all the sample IDs will be matched between your taxon table and metadata so that they will be in the same order and any sample IDs not present in one or the other will be dropped.</p>

<p>You can optionally filter out samples of a specific type during this step, but this can also be done separately as shown here.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">tax_table_fp</span> <span class="pl-k">=</span> system.file(<span class="pl-s"><span class="pl-pds">'</span>extdata<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>fruits_veggies_taxa_table_wTax.biom<span class="pl-pds">'</span></span>, 
                     <span class="pl-v">package</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>mctoolsr<span class="pl-pds">'</span></span>)
<span class="pl-v">map_fp</span> <span class="pl-k">=</span> system.file(<span class="pl-s"><span class="pl-pds">'</span>extdata<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>fruits_veggies_metadata.txt<span class="pl-pds">'</span></span>, 
                     <span class="pl-v">package</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>mctoolsr<span class="pl-pds">'</span></span>)
<span class="pl-v">input</span> <span class="pl-k">=</span> load_taxa_table(<span class="pl-smi">tax_table_fp</span>, <span class="pl-smi">map_fp</span>)</pre></div>

<pre><code>## 32 samples loaded
</code></pre>

<p>The loaded data will consist of three parts:</p>

<ol>
<li>The taxon table itself: "data_loaded"</li>
<li>The metadata: "map_loaded"</li>
<li>The taxonomic classifiers (if provided in the biom file): "taxonomy_loaded"</li>
</ol>

<p>Any of these components can be quickly accessed using the '$' sign notation as shown in the next example.  </p>

<h4>
<a id="returning-numbers-of-sequences-per-sample" class="anchor" href="#returning-numbers-of-sequences-per-sample" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Returning numbers of sequences per sample</h4>

<p>This can be achieved simply by calculating column sums on the taxon table:</p>

<div class="highlight highlight-source-r"><pre>sort(colSums(<span class="pl-smi">input</span><span class="pl-k">$</span><span class="pl-smi">data_loaded</span>))</pre></div>

<pre><code>## ProA37 ProB70 ProC66 ProB39 ProC40 ProB57 ProA12 ProA58 ProB34 ProC36 
##   1009   1011   1068   1152   1179   1192   1199   1216   1265   1313 
## ProA65  ProB9 ProB60 ProC65 ProB35 ProB10 ProB67 ProA66 ProB36 ProB71 
##   1367   1371   1395   1409   1492   1599   1611   1614   1642   1745 
## ProB40 ProA36 ProB58 ProB33 ProA16 ProA35 ProA33 ProB12 ProA13 ProA34 
##   1771   1802   1860   2257   2312   2530   2585   2642   2819   2982 
## ProA15 ProA14 
##   3291   3390
</code></pre>

<h4>
<a id="rarefying" class="anchor" href="#rarefying" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Rarefying</h4>

<p>As you can see from the previous example, we can rarefy (i.e. normalize for variable sequence depths) to 1000 sequences per sample without losing any samples. This can be done using the following command:</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">input_rar</span> <span class="pl-k">=</span> single_rarefy(<span class="pl-smi">input</span>, <span class="pl-c1">1000</span>)</pre></div>

<pre><code>## 32 samples remaining
</code></pre>

<div class="highlight highlight-source-r"><pre>colSums(<span class="pl-smi">input_rar</span><span class="pl-k">$</span><span class="pl-smi">data_loaded</span>)</pre></div>

<pre><code>## ProA12 ProA13 ProA14 ProA15 ProA16 ProA33 ProA34 ProA35 ProA36 ProA37 
##   1000   1000   1000   1000   1000   1000   1000   1000   1000   1000 
## ProA58 ProA65 ProA66 ProB10 ProB12 ProB33 ProB34 ProB35 ProB36 ProB39 
##   1000   1000   1000   1000   1000   1000   1000   1000   1000   1000 
## ProB40 ProB57 ProB58 ProB60 ProB67 ProB70 ProB71  ProB9 ProC36 ProC40 
##   1000   1000   1000   1000   1000   1000   1000   1000   1000   1000 
## ProC65 ProC66 
##   1000   1000
</code></pre>

<h4>
<a id="summarize-taxonomic-relative-abundances-at-a-higher-taxonomic-level" class="anchor" href="#summarize-taxonomic-relative-abundances-at-a-higher-taxonomic-level" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Summarize taxonomic relative abundances at a higher taxonomic level</h4>

<p>It is useful to get a feel for the taxonomic composition of your samples early on in the exploratory data analysis process. This can quickly be done by calculating taxonomic summaries at higher taxonomic levels - in this case at the phylum level. The values represent the sum of all the relative abundances for OTUs classified as belonging to the indicated phylum. In this example just the first few phyla and samples are shown.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">tax_sum_phyla</span> <span class="pl-k">=</span> summarize_taxonomy(<span class="pl-smi">input_rar</span>, <span class="pl-v">level</span> <span class="pl-k">=</span> <span class="pl-c1">2</span>, <span class="pl-v">report_higher_tax</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)
<span class="pl-smi">tax_sum_phyla</span>[<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">5</span>, <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">8</span>]</pre></div>

<pre><code>##                    ProA12 ProA13 ProA14 ProA15 ProA16 ProA33 ProA34 ProA35
## p__                 0.001  0.000  0.000  0.000  0.000  0.000  0.000  0.000
## p__[Thermi]         0.000  0.000  0.000  0.000  0.000  0.000  0.003  0.000
## p__Acidobacteria    0.002  0.000  0.000  0.000  0.000  0.000  0.000  0.000
## p__Actinobacteria   0.380  0.006  0.002  0.024  0.002  0.051  0.075  0.087
## p__Armatimonadetes  0.000  0.000  0.000  0.003  0.000  0.000  0.000  0.000
</code></pre>

<p>You can also quickly show differences in the relative abundances of taxanomic groups using a heatmap as shown below. We can easily see that mushrooms have a much lower relative abundance of Enterobacteriaceae than the other sample types.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">tax_sum_families</span> <span class="pl-k">=</span> summarize_taxonomy(<span class="pl-smi">input_rar</span>, <span class="pl-v">level</span> <span class="pl-k">=</span> <span class="pl-c1">5</span>, <span class="pl-v">report_higher_tax</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)
plot_ts_heatmap(<span class="pl-smi">tax_sum_families</span>, <span class="pl-smi">input_rar</span><span class="pl-k">$</span><span class="pl-smi">map_loaded</span>, <span class="pl-c1">0.01</span>, <span class="pl-s"><span class="pl-pds">'</span>Sample_type<span class="pl-pds">'</span></span>, <span class="pl-v">custom_sample_order</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">'</span>Lettuce<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Spinach<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Strawberries<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Mushrooms<span class="pl-pds">'</span></span>))</pre></div>

<p><img src="README_files/figure-html/unnamed-chunk-9-1.png" alt=""></p>

<h4>
<a id="calculating-a-dissimilarity-matrix" class="anchor" href="#calculating-a-dissimilarity-matrix" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calculating a dissimilarity matrix</h4>

<p>For dissimilarity-based analyses such as ordinations and PERMANOVA, it is necessary to calculate a dissimilarity matrix. There is currently support for Bray-Curtis dissimilarities based on square-root transformed data. This is a widely used dissimilarity metric for these analyses, but others will be added as requested.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">dm</span> <span class="pl-k">=</span> calc_dm(<span class="pl-smi">input_rar</span><span class="pl-k">$</span><span class="pl-smi">data_loaded</span>)</pre></div>

<h4>
<a id="plotting-an-ordination" class="anchor" href="#plotting-an-ordination" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Plotting an ordination</h4>

<p>There are two ways to plot ordinations in <strong>mctoolsr</strong>. The multistep way is shown here, but there is also a shortcut using the <code>plot_nmds()</code> function.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">ord</span> <span class="pl-k">=</span> calc_ordination(<span class="pl-smi">dm</span>, <span class="pl-s"><span class="pl-pds">'</span>nmds<span class="pl-pds">'</span></span>)</pre></div>

<pre><code>## Run 0 stress 0.1206532 
## Run 1 stress 0.1206548 
## ... procrustes: rmse 0.0001599613  max resid 0.0007254419 
## *** Solution reached
</code></pre>

<div class="highlight highlight-source-r"><pre>plot_ordination(<span class="pl-smi">input_rar</span>, <span class="pl-smi">ord</span>, <span class="pl-s"><span class="pl-pds">'</span>Sample_type<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Farm_type<span class="pl-pds">'</span></span>, <span class="pl-v">hulls</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)</pre></div>

<p><img src="README_files/figure-html/unnamed-chunk-11-1.png" alt=""></p>

<h4>
<a id="filtering-samples" class="anchor" href="#filtering-samples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Filtering samples</h4>

<p>It is easy to filter samples from your dataset in <strong>mctoolsr</strong>. You can specify to remove samples meeting a specified condition in the metadata or keep those samples. In the example below, lettuce samples are removed, and the ordination is plotted again.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">input_rar_filt</span> <span class="pl-k">=</span> filter_data(<span class="pl-smi">input_rar</span>, <span class="pl-s"><span class="pl-pds">'</span>Sample_type<span class="pl-pds">'</span></span>, <span class="pl-v">filter_vals</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Lettuce<span class="pl-pds">'</span></span>)</pre></div>

<pre><code>## 28 samples remaining
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-v">dm</span> <span class="pl-k">=</span> calc_dm(<span class="pl-smi">input_rar_filt</span><span class="pl-k">$</span><span class="pl-smi">data_loaded</span>)
<span class="pl-v">ord</span> <span class="pl-k">=</span> calc_ordination(<span class="pl-smi">dm</span>, <span class="pl-s"><span class="pl-pds">'</span>nmds<span class="pl-pds">'</span></span>)</pre></div>

<pre><code>## Run 0 stress 0.1235166 
## Run 1 stress 0.1212337 
## ... New best solution
## ... procrustes: rmse 0.08556598  max resid 0.2920493 
## Run 2 stress 0.1146686 
## ... New best solution
## ... procrustes: rmse 0.08985927  max resid 0.2832726 
## Run 3 stress 0.1145554 
## ... New best solution
## ... procrustes: rmse 0.009807793  max resid 0.0367577 
## Run 4 stress 0.1217904 
## Run 5 stress 0.1145536 
## ... New best solution
## ... procrustes: rmse 0.0002374229  max resid 0.0008392381 
## *** Solution reached
</code></pre>

<div class="highlight highlight-source-r"><pre>plot_ordination(<span class="pl-smi">input_rar_filt</span>, <span class="pl-smi">ord</span>, <span class="pl-s"><span class="pl-pds">'</span>Sample_type<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>Farm_type<span class="pl-pds">'</span></span>, <span class="pl-v">hulls</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)</pre></div>

<p><img src="README_files/figure-html/unnamed-chunk-12-1.png" alt=""></p>

<h4>
<a id="filtering-taxa" class="anchor" href="#filtering-taxa" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Filtering taxa</h4>

<p>There are multiple taxa filtering options in <strong>mctoolsr</strong>. This example shows how to explore the proteobacteria sequences across the samples. Taxa can also be filtered based on their relative abundance.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">input_proteobact</span> <span class="pl-k">=</span> filter_taxa_from_input(<span class="pl-smi">input</span>, <span class="pl-v">taxa_to_keep</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>p__Proteobacteria<span class="pl-pds">'</span></span>)</pre></div>

<pre><code>## 2265 taxa removed
</code></pre>

<div class="highlight highlight-source-r"><pre>sort(colSums(<span class="pl-smi">input_proteobact</span><span class="pl-k">$</span><span class="pl-smi">data_loaded</span>))</pre></div>

<pre><code>## ProC40 ProA14 ProA12 ProA58 ProA16 ProB70 ProB10  ProB9 ProA37 ProB12 
##    231    435    459    614    780    843    889    940    980   1019 
## ProC66 ProC36 ProB57 ProA13 ProA36 ProB39 ProB34 ProB60 ProA65 ProA35 
##   1032   1051   1063   1080   1082   1082   1196   1196   1261   1336 
## ProC65 ProB71 ProA34 ProB67 ProA66 ProB35 ProB58 ProB36 ProA15 ProB40 
##   1369   1376   1406   1422   1436   1472   1544   1594   1601   1748 
## ProA33 ProB33 
##   1768   2126
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-v">input_proteobact_rar</span> <span class="pl-k">=</span> single_rarefy(<span class="pl-smi">input_proteobact</span>, <span class="pl-c1">219</span>)</pre></div>

<pre><code>## 32 samples remaining
</code></pre>

<div class="highlight highlight-source-r"><pre>plot_nmds(calc_dm(<span class="pl-smi">input_proteobact_rar</span><span class="pl-k">$</span><span class="pl-smi">data_loaded</span>), <span class="pl-v">metadata_map</span> <span class="pl-k">=</span> <span class="pl-smi">input_proteobact_rar</span><span class="pl-k">$</span><span class="pl-smi">map_loaded</span>, 
          <span class="pl-v">color_cat</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Sample_type<span class="pl-pds">'</span></span>)</pre></div>

<pre><code>## Run 0 stress 0.123787 
## Run 1 stress 0.125684 
## Run 2 stress 0.1144185 
## ... New best solution
## ... procrustes: rmse 0.09762337  max resid 0.2789194 
## Run 3 stress 0.1252272 
## Run 4 stress 0.114415 
## ... New best solution
## ... procrustes: rmse 0.001719574  max resid 0.005385391 
## *** Solution reached
</code></pre>

<p><img src="README_files/figure-html/unnamed-chunk-13-1.png" alt=""></p>

<h4>
<a id="taxa-based-exploration" class="anchor" href="#taxa-based-exploration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Taxa based exploration</h4>

<p>It is often useful to determine the taxa driving differences between the community compositions of different sample types. This example shows one way to do this to determine taxa driving differences between sample types.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">tax_sum_families</span> <span class="pl-k">=</span> summarize_taxonomy(<span class="pl-smi">input_rar_filt</span>, <span class="pl-v">level</span> <span class="pl-k">=</span> <span class="pl-c1">5</span>, <span class="pl-v">report_higher_tax</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)
taxa_summary_by_sample_type(<span class="pl-smi">tax_sum_families</span>, <span class="pl-smi">input_rar_filt</span><span class="pl-k">$</span><span class="pl-smi">map_loaded</span>, 
                            <span class="pl-v">type_header</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Sample_type<span class="pl-pds">'</span></span>, <span class="pl-v">filter_level</span> <span class="pl-k">=</span> <span class="pl-c1">0.05</span>, <span class="pl-v">test_type</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>KW<span class="pl-pds">'</span></span>)</pre></div>

<pre><code>##                               pvals     pvalsBon     pvalsFDR Mushrooms
## f__Pseudomonadaceae    2.251673e-05 0.0001576171 0.0001576171  0.141625
## f__Sphingobacteriaceae 7.934777e-05 0.0005554344 0.0002777172  0.293125
## f__[Weeksellaceae]     3.012755e-04 0.0021089282 0.0007029761  0.105625
## f__Enterobacteriaceae  3.120009e-04 0.0021840065 0.0005460016  0.033250
## unclassified           1.977469e-03 0.0138422830 0.0027684566  0.077125
## f__Bacillaceae         2.342285e-02 0.1639599761 0.0273266627  0.002250
## f__Sphingomonadaceae   3.513676e-02 0.2459572979 0.0351367568  0.008000
##                             Spinach Strawberries
## f__Pseudomonadaceae    0.0678571429 0.0019230769
## f__Sphingobacteriaceae 0.0032857143 0.0007692308
## f__[Weeksellaceae]     0.0021428571 0.0016153846
## f__Enterobacteriaceae  0.7261428571 0.6177692308
## unclassified           0.0301428571 0.0226923077
## f__Bacillaceae         0.0042857143 0.1580769231
## f__Sphingomonadaceae   0.0005714286 0.0611538462
</code></pre>

<p>This analysis demonstrates that Pseudomonadaceae and Sphingobacteriaceae tend to have higher relative abundances on mushrooms than spinach and strawberries. The p values are based on Kruskal-Wallis tests and two different corrections are reported to deal with the multiple comparisons (Bonferroni and FDR). Rare taxa are filtered out using the <code>filter_level</code> peramter. The values indicated under the sample types are mean relative abundances.    </p>

<h4>
<a id="calculating-mean-dissimilarities" class="anchor" href="#calculating-mean-dissimilarities" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Calculating mean dissimilarities</h4>

<p>Sometimes it is necessary to calculate mean dissimilarities. This is important in cases where sample types are pseudoreplecated. This is not the case here, but this example demonstrates this functionality.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-v">dm</span> <span class="pl-k">=</span> calc_dm(<span class="pl-smi">input_rar_filt</span><span class="pl-k">$</span><span class="pl-smi">data_loaded</span>)
<span class="pl-v">dm_aggregated</span> <span class="pl-k">=</span> calc_mean_dissimilarities(<span class="pl-smi">dm</span>, <span class="pl-smi">input_rar_filt</span><span class="pl-k">$</span><span class="pl-smi">map_loaded</span>, 
                                          <span class="pl-s"><span class="pl-pds">'</span>Sample_Farming<span class="pl-pds">'</span></span>, <span class="pl-v">return_map</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
<span class="pl-v">ord</span> <span class="pl-k">=</span> calc_ordination(<span class="pl-smi">dm_aggregated</span><span class="pl-k">$</span><span class="pl-smi">dm</span>, <span class="pl-v">ord_type</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>nmds<span class="pl-pds">'</span></span>)</pre></div>

<pre><code>## Run 0 stress 0 
## Run 1 stress 2.739166e-05 
## ... procrustes: rmse 0.218308  max resid 0.3745 
## Run 2 stress 0 
## ... procrustes: rmse 0.2446559  max resid 0.4250695 
## Run 3 stress 0 
## ... procrustes: rmse 0.1148544  max resid 0.2019954 
## Run 4 stress 9.070047e-05 
## ... procrustes: rmse 0.01741263  max resid 0.03149269 
## Run 5 stress 0 
## ... procrustes: rmse 0.0294611  max resid 0.05420394 
## Run 6 stress 8.900239e-05 
## ... procrustes: rmse 0.01434851  max resid 0.02136145 
## Run 7 stress 0 
## ... procrustes: rmse 0.1967323  max resid 0.3594271 
## Run 8 stress 0 
## ... procrustes: rmse 0.1852564  max resid 0.3277199 
## Run 9 stress 0 
## ... procrustes: rmse 0.2321982  max resid 0.370431 
## Run 10 stress 0 
## ... procrustes: rmse 0.2616707  max resid 0.4185312 
## Run 11 stress 0 
## ... procrustes: rmse 0.2533339  max resid 0.4033764 
## Run 12 stress 0 
## ... procrustes: rmse 0.248833  max resid 0.3975527 
## Run 13 stress 0.1842128 
## Run 14 stress 0 
## ... procrustes: rmse 0.0169415  max resid 0.02214461 
## Run 15 stress 8.698707e-05 
## ... procrustes: rmse 0.01545266  max resid 0.02704799 
## Run 16 stress 8.18449e-05 
## ... procrustes: rmse 0.246017  max resid 0.3454335 
## Run 17 stress 8.648759e-05 
## ... procrustes: rmse 0.1811352  max resid 0.3231973 
## Run 18 stress 3.307416e-05 
## ... procrustes: rmse 0.0169743  max resid 0.02833947 
## Run 19 stress 0 
## ... procrustes: rmse 0.2408064  max resid 0.3820194 
## Run 20 stress 0 
## ... procrustes: rmse 0.2072957  max resid 0.366378
</code></pre>

<pre><code>## Warning in vegan::metaMDS(dm, k = 2): Stress is (nearly) zero - you may
## have insufficient data
</code></pre>

<div class="highlight highlight-source-r"><pre>plot_ordination(<span class="pl-smi">dm_aggregated</span>, <span class="pl-smi">ord</span>, <span class="pl-v">color_cat</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>Sample_type<span class="pl-pds">'</span></span>)</pre></div>

<p><img src="README_files/figure-html/unnamed-chunk-15-1.png" alt=""></p>

<h4>
<a id="exporting-a-taxa-table" class="anchor" href="#exporting-a-taxa-table" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exporting a taxa table</h4>

<p>Taxa tables that have been edited in *<em>mctoolsr</em> can be exported in text (tab delimited) format for later use. Use this function:</p>

<div class="highlight highlight-source-r"><pre>export_taxa_table(<span class="pl-smi">input_rar_filt</span>, <span class="pl-s"><span class="pl-pds">"</span>export/path/otu_table_export.txt<span class="pl-pds">"</span></span>)</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">mctoolsr maintained by <a href="https://github.com/leffj">leffj</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
